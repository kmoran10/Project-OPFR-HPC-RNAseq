oil$M_v_low %>% filter(symbol == "Esrrb") #no
oil$M_v_high %>% filter(symbol == "Esrrb") #no
oil$low_v_high %>% filter(symbol == "Esrrb") #no
oil$M_v_high %>% filter(symbol == "Esrr2") #no
TREAT %>% filter(symbol == "Esrrb") # no
oil$M_v_low %>% filter(symbol == "Esrra") #no
data <- read.csv("rawdata/KT_Counts.csv")
phenoData <- read.csv("rawdata/kim rnaseq phenodata.csv")
data[1:10, 1:10]
head(phenoData)
# prepare data
data <- data %>%
gather(key = "samples", value = "counts", -X) %>%
rename(gene = X) %>%
inner_join(., phenoData, by = c("samples" = "id")) %>%
select(1, 3, 2) %>%
spread(key = "samples", value = "counts") %>%
column_to_rownames(var = "gene")
# 2. QC - outlier detection ------------------------------------------------
# detect outlier genes
gsg <- goodSamplesGenes(t(data))
summary(gsg)
gsg$allOK
# remove genes that are detected as outliers
data <- data[gsg$goodGenes == TRUE,]
# pca - method 2 for finding outliers
# exclude outlier samples
samples.to.be.excluded <- c('KT021')
data.subset <- data[,!(colnames(data) %in% samples.to.be.excluded)]
### ***  note in results that we exclude KT021 because of higher variance compared to all other samples
phenoData <- phenoData %>%
column_to_rownames(var = "id")
# exclude outlier samples
colData <- phenoData %>%
filter(!row.names(.) %in% samples.to.be.excluded)
all(rownames(colData) %in% colnames(data.subset))
all(rownames(colData) == colnames(data.subset))
#good
#in r, i have a data frame called "data.subset" and one called "colData" that i want processed with tidyverse when possible. first, current rownames need to be actual columns. for data.subset it needs to be $gene and for colData it needs to be "sample". then I want to remove the rows of "data.subset" when the value in over 75% of the rows across all columns is less that 15. Then, I want to normalize the resulting data frame. Then I want to make the data long format -- currently the columns are all sample names, and I want the rows to be the sample names, with the columns to the names of the current row names. this will make the row names match the row names in "colData." Then join these two data frames in a data frame called gene.data
# Step 1: Convert rownames to columns
data.subset <- data.subset %>%
rownames_to_column(var = "gene") # Create a "gene" column from rownames
colData <- colData %>%
rownames_to_column(var = "sample") # Create a "sample" column from rownames
# Step 2: Remove rows from data.subset where over 75% of values are < 15
data.subset <- data.subset %>%
filter(rowMeans(select(., -gene) < 15) <= 0.75)
# Step 3: Transform to long format (tidy the data)
data.subset_long <- data.subset %>%
pivot_longer(cols = -gene, names_to = "sample", values_to = "value")
# Step 4: Join with colData based on "sample"
gene.data <- data.subset_long %>%
inner_join(colData, by = "sample")
#### analysis ####
# gotta get all counts, filter bad samples (same as other analyses), filter counts too low, normalize expression, then attach colData to sample names.
# then can do basically:
# GOI <- df %>% filter(symbol == "GOI") %>% FLIP ORIENTATION
# lmer(gene ~ treatment*E_level + (1|sample)) ---- basically this
## cognition related
# BDNF (Brain-Derived Neurotrophic Factor) -- NONE
gene.data %>% filter(gene == "Bdnf") %>%
lm(value ~ treatment*E_level,.) -> bdnflm
summary(bdnflm)
anova(bdnflm)
# CREB (cAMP Response Element-Binding Protein) -- NONE
gene.data %>% filter(gene == "Creb1") %>%
lm(value ~ treatment*E_level,.) -> creb1lm
summary(creb1lm)
anova(creb1lm)
# ARC (Activity-Regulated Cytoskeleton-Associated Protein) -- NONE
gene.data %>% filter(gene == "Arc") %>%
lm(value ~ treatment*E_level,.) -> arclm
summary(arclm)
anova(arclm)
# NR2B (NMDA Receptor Subunit 2B) -- NONE
gene.data %>% filter(gene == "Grin2b") %>%
lm(value ~ treatment*E_level,.) -> grin2blm
summary(grin2blm)
anova(grin2blm)
# Gria1 (AMPA Receptor Subunit 1 / GluR1) -- NONE
gene.data %>% filter(gene == "Gria1") %>%
lm(value ~ treatment*E_level,.) -> gria1lm
summary(gria1lm)
anova(gria1lm)
# Syn1 (Synapsin I) -- NONE
gene.data %>% filter(gene == "Syn1") %>%
lm(value ~ treatment*E_level,.) -> syn1lm
summary(syn1lm)
anova(syn1lm)
# DGKÎ¶ - Dgkz (Diacylglycerol Kinase Zeta) -- Gdkz IS lower in OPFR
gene.data %>% filter(gene == "Dgkz") %>%
lm(value ~ treatment*E_level,.) -> Dgkzlm
summary(Dgkzlm)
anova(Dgkzlm)
gene.data %>% filter(gene == "Dgkz") %>%
lm(value ~ treatment+E_level,.) -> Dgkzlm2
summary(Dgkzlm2)
# Shank3 -- NONE
gene.data %>% filter(gene == "Shank3") %>%
lm(value ~ treatment*E_level,.) -> Shank3lm
summary(Shank3lm)
anova(Shank3lm)
# CB1R --  Cnr1 (Cannabinoid Receptor 1) -- NONE
gene.data %>% filter(gene == "Cnr1") %>%
lm(value ~ treatment*E_level,.) -> Cnr1lm
summary(Cnr1lm)
anova(Cnr1lm)
# Zif268 (Egr1 or Early Growth Response 1) -- NONE
gene.data %>% filter(gene == "Egr1") %>%
lm(value ~ treatment*E_level,.) -> Egr1lm
summary(Egr1lm)
anova(Egr1lm)
## stress related
# CRH -- NONE
gene.data %>% filter(gene == "Crh") %>%
lm(value ~ treatment*E_level,.) -> Crh
summary(Crh)
anova(Crh)
# CRHR1 -- NONE
gene.data %>% filter(gene == "Crhr1") %>%
lm(value ~ treatment*E_level,.) -> Crhr1
summary(Crhr1)
anova(Crhr1)
gene.data %>% filter(gene == "Crhr1") %>%
lm(value ~ treatment+E_level,.) -> Crhr1.2
summary(Crhr1.2)
# CRHR2 -- NONE
gene.data %>% filter(gene == "Crhr2") %>%
lm(value ~ treatment*E_level,.) -> Crhr2
summary(Crhr2)
anova(Crhr2)
# PACAP -- Adcyap1 -- NONE
gene.data %>% filter(gene == "Adcyap1") %>%
lm(value ~ treatment*E_level,.) -> Adcyap1
summary(Adcyap1)
anova(Adcyap1)
# STEP -- Ptpn5??
gene.data %>% filter(gene == "Ptpn5") %>%
lm(value ~ treatment*E_level,.) -> Ptpn5
summary(Ptpn5)
anova(Ptpn5)
gene.data %>% filter(gene == "Ptpn5") %>%
lm(value ~ treatment+E_level,.) -> Ptpn5.2
summary(Ptpn5.2)
# UCN -- NO EXPRESSION
gene.data %>% filter(gene == "Ucn") %>%
lm(value ~ treatment*E_level,.) -> Ucn
# IL6 -- NONE
gene.data %>% filter(gene == "Il6") %>%
lm(value ~ treatment*E_level,.) -> Il6
# IL6 -- NONE
TREAT %>% filter(symbol == "Ptpn5")
# IL6 -- NONE
TREAT %>% filter(symbol == "Il6")
# IL6 -- NONE
TREAT %>% filter(symbol == "IL6")
# IL6 -- NONE
TREAT %>% filter(entrez == "3569")
# IL6 -- NONE
TREAT %>% filter(symbol == "Il-6")
View(TREAT)
# IL6 -- NONE
TREAT %>% filter(symbol == "Ptgs2")
# Cox2 -- NONE
TREAT %>% filter(symbol == "Tlr4")
# Cox2 -- NONE
TREAT %>% filter(symbol == "TLR4")
# Cox2 -- NONE
TREAT %>% filter(symbol == "Tlr4")
# Cox2 -- NONE
TREAT %>% filter(symbol == "Stat3")
# Stat3 -- NONE
TREAT %>% filter(symbol == "Nfkb")
# Stat3 -- NONE
TREAT %>% filter(symbol == "Nfkb1")
# Nfkb1 -- NONE
TREAT %>% filter(symbol == "Nfkb2")
# Nfkb1 -- NO diff
TREAT %>% filter(symbol == "Cx3cl1")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Irf7")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Ifng")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Imd69")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Ifg")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Ifi")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Ifl")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Ifng")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Infg")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Ifna")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Ifna1")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Ifna2")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Il1b")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Irfg")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Irfa")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Irfa1")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Irf1")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Irf2")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Irf3")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Irf9")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Irf11")
# Cx3cl1 -- NO diff
TREAT %>% filter(symbol == "Irf10")
#  -- NO diff
TREAT %>% filter(symbol == "Ifnb1")
#  -- NO diff
TREAT %>% filter(symbol == "IFNB1")
#  -- NO diff
TREAT %>% filter(symbol == "Ifnb1")
#  -- NO diff
TREAT %>% filter(symbol == "Ifnb")
#  -- NO diff
TREAT %>% filter(symbol == "Ifnb3")
#  -- NO diff
TREAT %>% filter(symbol == "Ifnb5")
#  -- NO diff
TREAT %>% filter(symbol == "Ifnb2")
#  -- NO diff
TREAT %>% filter(symbol == "Ifb")
#  -- NO diff
TREAT %>% filter(symbol == "Iff")
#  -- NO diff
TREAT %>% filter(symbol == "Ifnb")
# TREATMENT only GO Analysis
library(limma)
library(edgeR)
library(Mus.musculus)
organism = 'org.Mm.eg.db'
library(organism, character.only = TRUE)
library(biomaRt)
library(AnnotationDbi)
library(pheatmap)
library(annotables)
library(clusterProfiler)
library(enrichplot)
library(DOSE)
library(tidyverse)
grcm38 # mouse genes
treatgo <- read.csv("results/results_tables/top100_GOterms_TREATMENT.csv")
View(treatgo)
# First, split the geneID column into individual genes and count occurrences by direction
gene_counts <- treatgo %>%
# Split each geneID into separate rows (one gene per row)
separate_rows(geneID, sep = "/") %>%
# Count how many times each gene appears in each direction
count(direction, geneID, name = "gene_count") %>%
# Arrange by count in descending order within each direction
arrange(direction, desc(gene_count)) %>%
# Group by direction to rank genes within each direction
group_by(direction) %>%
# Add a rank column to identify the most common genes
mutate(rank = row_number()) %>%
ungroup()
View(gene_counts)
# Now join this back with the original data to get the descriptions
result <- gene_counts %>%
# Join with original data to get all descriptions where each gene appears
left_join(
treatgo %>%
separate_rows(geneID, sep = "/") %>%
select(direction, geneID, Description),
by = c("direction", "geneID")
) %>%
# Group by direction and gene to combine all descriptions where the gene appears
group_by(direction, geneID, gene_count, rank) %>%
summarise(
descriptions = paste(unique(Description), collapse = "; "),
.groups = "drop"
) %>%
# Keep only the top N genes for each direction (adjust as needed)
filter(rank <= 10) %>%  # Change this number to include more/less top genes
# Arrange the final output
arrange(direction, desc(gene_count))
View(result)
grcm38 # mouse genes
mgenes <- grcm38 # mouse genes
View(mgenes)
# First, process the treatgo data as before
gene_counts <- treatgo %>%
separate_rows(geneID, sep = "/") %>%
count(direction, geneID, name = "gene_count") %>%
arrange(direction, desc(gene_count)) %>%
group_by(direction) %>%
mutate(rank = row_number()) %>%
ungroup()
# Join with mgenes to get the gene descriptions
result_with_desc <- gene_counts %>%
# Join with mgenes using geneID = symbol
left_join(
mgenes %>% select(symbol, gene_description = description),
by = c("geneID" = "symbol")
) %>%
# Now join with original data to get the treatgo descriptions
left_join(
treatgo %>%
separate_rows(geneID, sep = "/") %>%
select(direction, geneID, treatgo_description = Description),
by = c("direction", "geneID")
) %>%
# Group and combine the treatgo descriptions
group_by(direction, geneID, gene_count, rank, gene_description) %>%
summarise(
treatgo_descriptions = paste(unique(treatgo_description), collapse = "; "),
.groups = "drop"
) %>%
# Keep only top genes
filter(rank <= 10) %>%
arrange(direction, desc(gene_count))
View(result_with_desc)
TREAT <- readRDS("results/TREATMENT_limma_results.RDS")
TREAT %>% filter(symbol == "Gabra1")
result_with_desc
TREAT %>% filter(symbol == "Wnt5a")
TREAT %>% filter(symbol == "Tgfb1") #not diff
View(TREAT)
result_with_desc %>%
mutate(
treat_data = map(geneID, ~ TREAT %>% filter(symbol == .x))
)
result_with_desc %>%
mutate(
treat_data = map(geneID, ~ TREAT %>% filter(symbol == .x))
)%>%
unnest(treat_data, keep_empty = TRUE)
GO_top_genes <- result_with_desc %>%
mutate(
treat_data = map(geneID, ~ TREAT %>% filter(symbol == .x))
)%>%
unnest(treat_data, keep_empty = TRUE)
View(GO_top_genes)
GO_top_genes_table <- GO_top_genes %>%
select(1,2,3,4,5,6,8,9,10)
View(GO_top_genes_table)
write.csv(GO_top_genes_table,"results/results_tables/GO_top_genes_table.csv", row.names = F)
library(limma)
library(edgeR)
library(Mus.musculus)
organism = 'org.Mm.eg.db'
library(organism, character.only = TRUE)
library(biomaRt)
library(AnnotationDbi)
library(pheatmap)
library(annotables)
library(clusterProfiler)
library(enrichplot)
library(DOSE)
library(tidyverse)
grcm38 # mouse genes
source("functions/gettop10GO.R")
library(limma)
library(edgeR)
library(Mus.musculus)
organism = 'org.Mm.eg.db'
library(organism, character.only = TRUE)
library(biomaRt)
library(AnnotationDbi)
library(pheatmap)
library(annotables)
library(clusterProfiler)
library(enrichplot)
library(DOSE)
library(tidyverse)
grcm38 # mouse genes
source("functions/gettop10GO.R")
### GO Top Genes -- Low E-level
mgenes <- grcm38 # mouse genes
# high e-level
treatgo.he <- read.csv("results/results_tables/top10_GOterms_high.csv")
# First, process the treatgo data as before
gene_counts.he <- treatgo.he %>%
separate_rows(geneID, sep = "/") %>%
count(direction, geneID, name = "gene_count") %>%
arrange(direction, desc(gene_count)) %>%
group_by(direction) %>%
mutate(rank = row_number()) %>%
ungroup()
# Join with mgenes to get the gene descriptions
result_with_desc.he <- gene_counts.he %>%
# Join with mgenes using geneID = symbol
left_join(
mgenes %>% select(symbol, gene_description = description),
by = c("geneID" = "symbol")
) %>%
# Now join with original data to get the treatgo descriptions
left_join(
treatgo.he %>%
separate_rows(geneID, sep = "/") %>%
select(direction, geneID, treatgo_description = Description),
by = c("direction", "geneID")
) %>%
# Group and combine the treatgo descriptions
group_by(direction, geneID, gene_count, rank, gene_description) %>%
summarise(
treatgo_descriptions = paste(unique(treatgo_description), collapse = "; "),
.groups = "drop"
) %>%
# Keep only top genes
filter(rank <= 10) %>%
arrange(direction, desc(gene_count))
result_with_desc.he
GO_top_genes.he <- result_with_desc.he %>%
mutate(
treat_data = map(geneID, ~ low %>% filter(symbol == .x))
)%>%
unnest(treat_data, keep_empty = TRUE)
males <- readRDS("results/Elevel_M_limma_results.RDS")
low <- readRDS("results/Elevel_low_limma_results.RDS")
high <- readRDS("results/Elevel_high_limma_results.RDS")
# high e-level
treatgo.he <- read.csv("results/results_tables/top10_GOterms_high.csv")
# First, process the treatgo data as before
gene_counts.he <- treatgo.he %>%
separate_rows(geneID, sep = "/") %>%
count(direction, geneID, name = "gene_count") %>%
arrange(direction, desc(gene_count)) %>%
group_by(direction) %>%
mutate(rank = row_number()) %>%
ungroup()
# Join with mgenes to get the gene descriptions
result_with_desc.he <- gene_counts.he %>%
# Join with mgenes using geneID = symbol
left_join(
mgenes %>% select(symbol, gene_description = description),
by = c("geneID" = "symbol")
) %>%
# Now join with original data to get the treatgo descriptions
left_join(
treatgo.he %>%
separate_rows(geneID, sep = "/") %>%
select(direction, geneID, treatgo_description = Description),
by = c("direction", "geneID")
) %>%
# Group and combine the treatgo descriptions
group_by(direction, geneID, gene_count, rank, gene_description) %>%
summarise(
treatgo_descriptions = paste(unique(treatgo_description), collapse = "; "),
.groups = "drop"
) %>%
# Keep only top genes
filter(rank <= 10) %>%
arrange(direction, desc(gene_count))
result_with_desc.he
GO_top_genes.he <- result_with_desc.he %>%
mutate(
treat_data = map(geneID, ~ high %>% filter(symbol == .x))
)%>%
unnest(treat_data, keep_empty = TRUE)
GO_top_genes_HE_table <- GO_top_genes.he %>%
select(1,2,3,4,5,6,8,9,10)
write.csv(GO_top_genes_HE_table,"results/results_tables/GO_top_genes_HE_table.csv", row.names = F)
write.csv(GO_top_genes_HE_table,"results/results_tables/GO_top_genes_HE_table.csv", row.names = F)
View(GO_top_genes_HE_table)
treatgo.m <- read.csv("results/results_tables/top10_GOterms_M.csv")
# First, process the treatgo data as before
gene_counts.m <- treatgo.m %>%
separate_rows(geneID, sep = "/") %>%
count(direction, geneID, name = "gene_count") %>%
arrange(direction, desc(gene_count)) %>%
group_by(direction) %>%
mutate(rank = row_number()) %>%
ungroup()
# Join with mgenes to get the gene descriptions
result_with_desc.m <- gene_counts.m %>%
# Join with mgenes using geneID = symbol
left_join(
mgenes %>% select(symbol, gene_description = description),
by = c("geneID" = "symbol")
) %>%
# Now join with original data to get the treatgo descriptions
left_join(
treatgo.m %>%
separate_rows(geneID, sep = "/") %>%
select(direction, geneID, treatgo_description = Description),
by = c("direction", "geneID")
) %>%
# Group and combine the treatgo descriptions
group_by(direction, geneID, gene_count, rank, gene_description) %>%
summarise(
treatgo_descriptions = paste(unique(treatgo_description), collapse = "; "),
.groups = "drop"
) %>%
# Keep only top genes
filter(rank <= 10) %>%
arrange(direction, desc(gene_count))
result_with_desc.m
GO_top_genes.m <- result_with_desc.m %>%
mutate(
treat_data = map(geneID, ~ males %>% filter(symbol == .x))
)%>%
unnest(treat_data, keep_empty = TRUE)
GO_top_genes_M_table <- GO_top_genes.m %>%
select(1,2,3,4,5,6,8,9,10)
View(GO_top_genes.m)
write.csv(GO_top_genes_M_table,"results/results_tables/GO_top_genes_M_table.csv", row.names = F)

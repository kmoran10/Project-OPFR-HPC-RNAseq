
# GO analysis 

library(limma)
library(edgeR)
library(Mus.musculus)
organism = 'org.Mm.eg.db'
library(organism, character.only = TRUE)
library(biomaRt)
library(AnnotationDbi)
library(pheatmap)
library(annotables)
library(clusterProfiler)
library(enrichplot)
library(DOSE)
library(tidyverse)
grcm38 # mouse genes


source("functions/gettop10GO.R")


my_logFC_threshold = 0.2




males <- readRDS("results/Elevel_M_limma_results.RDS")

gettop10GO(males, my_showCategory) %>% 
  mutate(comparison = "Oil - OPFR") -> top10_GOterms_M


write.csv(top10_GOterms_M,"results/results_tables/top10_GOterms_M.csv", row.names = F)





low <- readRDS("results/Elevel_low_limma_results.RDS")

gettop10GO(low, my_showCategory) %>% 
  mutate(comparison = "Oil - OPFR") -> top10_GOterms_low


write.csv(top10_GOterms_low,"results/results_tables/top10_GOterms_low.csv", row.names = F)






high <- readRDS("results/Elevel_high_limma_results.RDS")

gettop10GO(high, my_showCategory) %>% 
  mutate(comparison = "Oil - OPFR") -> top10_GOterms_high


write.csv(top10_GOterms_high,"results/results_tables/top10_GOterms_high.csv", row.names = F)




TREAT <- readRDS("results/TREATMENT_limma_results.RDS")
males <- readRDS("results/Elevel_M_limma_results.RDS")
low <- readRDS("results/Elevel_low_limma_results.RDS")
high <- readRDS("results/Elevel_high_limma_results.RDS")
oil <- readRDS("results/Oil_limma_results.RDS")
opfr <- readRDS("results/OPFR_limma_results.RDS")


oil_mvlow <- oil$M_v_low
oil_mvhigh <- oil$M_v_high
oil_lvh <- oil$low_v_high
opfr_mvlow <- opfr$M_v_low
opfr_mvhigh <- opfr$M_v_high
opfr_lvh <- opfr$low_v_high



gettop10GO(oil_mvlow, my_showCategory) %>% 
  mutate(comparison = "M - low") -> top10_GOterms_oil_mvlow

gettop10GO(oil_mvhigh, my_showCategory) %>% 
  mutate(comparison = "M - high") -> top10_GOterms_oil_mvhigh

gettop10GO(oil_lvh, my_showCategory) %>% 
  mutate(comparison = "low - high") -> top10_GOterms_oil_lowvhigh


gettop10GO(opfr_mvlow, my_showCategory) %>% 
  mutate(comparison = "M - low") -> top10_GOterms_opfr_mvlow

gettop10GO(opfr_mvhigh, my_showCategory) %>% 
  mutate(comparison = "M - high") -> top10_GOterms_opfr_mvhigh

gettop10GO(opfr_lvh, my_showCategory) %>% 
  mutate(comparison = "low - high") -> top10_GOterms_opfr_lowvhigh
